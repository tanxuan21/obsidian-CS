# 操作系統管理內存方式
- 重定位relocation
- 分段segmentation
- 分頁paging
- 虛擬化存儲virtual memory/storage

高度依賴硬件，MMU處理單元


# 地址和地址空間

- 物理地址
- 虛擬地址
- 邏輯地址
邏輯地址是編譯器編譯生成的地址，
> ?
# 虛擬存儲作用

## 外存

擴容
## 簡化編譯加載運行

- 編譯鏈接
- 加載
- 共享
- 內存分配，虛擬內存連續，物理內存不連續
## 保護數據

相對獨立性

# 內存分配

靜態內存分配
全局靜態變量
常量數據段
代碼段

動態內存分配
棧stack
堆heap

棧由編譯器管理，堆由程序員管理
棧有限制高度。不能太高。


# 連續內存分配
## 問題與麻煩

#### 內碎片
#### 外碎片

#### 麻煩：
1. 空閒塊的組織 用什麼數據結構維護？
2. 放置的位置 選那塊來放置？
3. 分割 怎麼分未分配的空間？
4. 合併 如何處理分配完的塊？


## 匹配策略

#### 最先匹配first fit
直接上，往高地址空間去放。
太他媽粗暴了，效率肯定差死了
#### 最佳匹配best fit
不那麼粗暴，先查找所有的空閒塊，找到比程序大但是空間最小的空閒塊，放入。減少浪費，減少內碎片
釋放的時候，查找相鄰的合併。
但是有外碎片的問題
#### 最差匹配
找最大的空閒塊。
有外碎片，但是對於中等大小的分配多時，效果好。
容易破壞大的空間。

#### 綜合-伙伴系統Buddy System
二叉樹的管理方式。二分劃分，直到找到一個劃分出來的子塊比需要的大，這個子塊的一半又比需要的小。即可。
合併：地址相鄰的，大小相同的。

課後練習：
實現buddy system


# 非連續內存分配
旨在解決碎片問題，共享和安全問題。
## 段式存處管理Segment
將程序劃分為一段一段的，可以做到有效的分割，讓碎片更好的利用起來
但是每一段也不固定，還是會有大小不一的段，可能有的程序的段很多。
## 頁式存處管理
集裝箱，標準件。徹底解決碎片問題。

### 挑戰
訪問內存效率折半，先訪問頁表，再訪問物理內存。
頁表可能非常大。

緩存
間接訪問



> 怎麼實現的？
### 頁表實現
### 多級頁表實現
### 反置頁表
使用hash，查找對應頁表的